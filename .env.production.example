# ==================================================
# Laravel Octane / Swoole (Production VPS Optimized)
# ==================================================
# VPS 2 CPU / 4GB RAM - Stable Configuration
#
# Rumus optimal:
# - SWOOLE_WORKER_NUM = CPU cores * 2 (untuk I/O bound)
# - SWOOLE_TASK_WORKER_NUM = CPU cores
# - SWOOLE_REACTOR_NUM = CPU cores

OCTANE_SERVER=swoole
SWOOLE_WORKER_NUM=4
SWOOLE_TASK_WORKER_NUM=2
SWOOLE_REACTOR_NUM=2
SWOOLE_MAX_REQUEST=500
SWOOLE_MAX_COROUTINE=1000
OCTANE_GARBAGE_COLLECTION=50
OCTANE_MAX_EXECUTION_TIME=30

# CRITICAL: Disable PDO coroutine hook untuk PostgreSQL stability
# Ini mencegah race condition antara Swoole coroutine dan PDO PostgreSQL
SWOOLE_DISABLE_PDO_HOOK=true

# Jika masih crash, coba disable coroutine sepenuhnya:
# SWOOLE_ENABLE_COROUTINE=false

# ==================================================
# Database Connection Pool
# ==================================================
# Untuk VPS dengan PostgreSQL max_connections=100:
# - Total connections = SWOOLE_WORKER_NUM * pool_size
# - Dengan 4 workers dan pool 10 = 40 connections (aman)
DB_POOL_SIZE=10
DB_POOL_MIN=2

# ==================================================
# Redis Connection Pool
# ==================================================
REDIS_MAX_CONNS=20
REDIS_MIN_CONNS=2

# ==================================================
# PostgreSQL Tuning (di postgresql.conf)
# ==================================================
# max_connections = 100
# shared_buffers = 1GB (25% of 4GB RAM)
# effective_cache_size = 3GB (75% of 4GB RAM)
# work_mem = 4MB
# maintenance_work_mem = 128MB
# checkpoint_completion_target = 0.9
# wal_buffers = 16MB
# random_page_cost = 1.1 (untuk SSD)

# ==================================================
# Rate Limiting (Production)
# ==================================================
RATE_LIMIT_API_DEFAULT_MAX=60
RATE_LIMIT_AUTH_MAX=5
RATE_LIMIT_ENROLLMENT_MAX=30
